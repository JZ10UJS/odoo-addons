<openerp>
    <data>
        <!--添加js文件使其生效（主要是修改导航栏最右边的下拉菜单）-->
        <template id="assets_backend" name="yycrm_assets" inherit_id="web.assets_backend">
            <xpath expr="." position="inside">
                <script type="text/javascript" src="/yycrm/static/src/js/yycrm.js"/>
                <script type="text/javascript" src="/yycrm/static/src/js/yykanban.js"/>
            </xpath>
        </template>

        <!--对sales/customers进行一些定制化   res.partner-->
        <record id="yy_cus_view_tree" model="ir.ui.view">
            <!--修改customer的tree字段-->
            <field name="name">YYCRM res partner view tree</field>
            <field name="model">res.partner</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="company_type"/>
                    <field name="mobile"/>
                    <field name="phone"/>
                    <field name="create_uid"/>
                    <field name="user_id" string="Salesman"/>
                </tree>
            </field>
        </record>
        <record id="yy_res_partner_view_form_inherited" model="ir.ui.view">
            <!--继承base.view_partner_form，修改其外观-->
            <field name="name">YYCRM res partner view form inherited</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/group" position="replace">
                    <field name="type" attrs="{'invisible': [('parent_id','=', False)]}" groups="base.group_no_one"/>
                    <group  string="Base Info">
                        <group>
                            <field name="function" placeholder="e.g. Sales Director" attrs="{'invisible': [('is_company','=', True)]}"/>
                            <field name="website" widget="url" placeholder="e.g. www.cloudguarding.com"
                                attrs="{'invisible': [('is_company','!=', True)]}"/>
                            <field name="mobile" widget="phone" attrs="{'invisible': [('is_company','=', True)]}"/>
                            <field name="phone" widget="phone"/>
                            <field name="trade" attrs="{'invisible': [('is_company','!=', True)]}"/>
                        </group>
                        <group>
                            <field name="department" attrs="{'invisible': [('is_company','=', True)]}"/>
                            <field name="fax" attrs="{'invisible': [('is_company','=', True)]}"/>
                            <field name="email" attrs="{'invisible': [('is_company','=', True)]}"/>
                        </group>
                    </group>
                    <group>
                        <group string="Address">
                            <!--<label for="street" string="Address"/>-->
                            <!--<div class="o_address_format">-->
                            <!--<div class="oe_edit_only">-->
                                <!--<button name="open_parent" type="object" string="(edit)" class="oe_link"-->
                                        <!--attrs="{'invisible': [('parent_id', '=', False)]}"/>-->
                            <!--</div>-->

                            <field name="street" placeholder="Street..." class="o_address_street"
                                   attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
                            <field name="street2" placeholder="Street 2..." class="o_address_street" invisible="1"
                                   attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
                            <field name="city" placeholder="City" class="o_address_city"
                                   attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
                            <field name="state_id" class="o_address_state" placeholder="State"
                                   options="{&quot;no_open&quot;: True}" on_change="onchange_state(state_id)"
                                   attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"
                                   context="{'country_id': country_id, 'zip': zip}"/>
                            <field name="zip" placeholder="ZIP" class="o_address_zip"
                                   attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
                            <field name="country_id" placeholder="Country" class="o_address_country"
                                   options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}"
                                   attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}"/>
                            <!--</div>-->
                        </group>
                        <group>
                            <!--占位置，无实用-->
                        </group>
                    </group>
                </xpath>
                <xpath expr="//page[@name='sales_purchases']" position="attributes">
                    <attribute name="groups">base.group_sale_manager</attribute>
                </xpath>
            </field>
        </record>

        <!--对sales/opportunity定制   crm.lead-->
        <record id="yy_oppor_view_form_inherited" model="ir.ui.view">
            <field name="name">YYCRM crm lead oppor view form inherited</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/group" position="replace">
                    <group>
                        <group>
                            <field name="partner_id" on_change="on_change_partner_id(partner_id)" string="Customer"
                                   context="{'default_name': partner_name,
                                             'default_country_id': country_id,
                                             'default_function': function,
                                             'default_email': email_from,
                                             'default_user_id': user_id,
                                             'default_team_id': team_id,
                                             'default_trade': trade,
                                             }"
                                    domain="[('customer','=',True),('parent_id', '=', False)]"/>
                            <field name="date_deadline"/>
                            <field name="email_from" string="Email" widget="email"/>
                        </group>
                        <group>
                            <field name="trade"/>
                            <field name="last_activity_id" invisible="1"/>
                                <label for="next_activity_id"/>
                                <div>
                                    <div class="o_row mr16">
                                        <field name="next_activity_id" options="{'no_create': True, 'no_open': True}" domain="['|',('team_id','=',False),('team_id','=',team_id)]" on_change="onchange_next_activity_id(next_activity_id)"/>
                                        <span class="oe_form_field" attrs="{'invisible': ['|', ('next_activity_id', '=', False), ('date_action', '=', False)]}"> on </span>
                                        <field name="date_action" attrs="{'invisible': [('next_activity_id', '=', False)]}" placeholder="Choose a date..."/>
                                        <div attrs="{'invisible': ['|', ('last_activity_id', '=', False), ('next_activity_id', '!=', False)]}">
                                            <button name="log_next_activity_1" type="object" class="btn-link" attrs="{'invisible': [('next_activity_1','=',False)]}">
                                                <field name="next_activity_1" readonly="1"/>
                                            </button>
                                            <span attrs="{'invisible': [('next_activity_2','=',False)]}">|</span>
                                            <button name="log_next_activity_2" type="object" class="btn-link" attrs="{'invisible': [('next_activity_2','=',False)]}">
                                                <field name="next_activity_2" readonly="1"/>
                                            </button>
                                            <span attrs="{'invisible': [('next_activity_3','=',False)]}">|</span>
                                            <button name="log_next_activity_3" type="object" class="btn-link" attrs="{'invisible': [('next_activity_3','=',False)]}">
                                                <field name="next_activity_3" readonly="1"/>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="o_row">
                                        <field name="title_action" placeholder="e.g. Discuss proposal" attrs="{'invisible': [('next_activity_id', '=', False)]}"/>
                                        <div attrs="{'invisible': [('next_activity_id', '=', False)]}">
                                            <button name="log_next_activity_done" string="Done" type="object" class="btn-link"/>
                                            <button name="cancel_next_activity" string="Cancel" type="object" class="btn-link"/>
                                        </div>
                                    </div>
                                </div>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="user_id" on_change="on_change_user(user_id, context)"
                                   context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'base.group_sale_salesman_all_leads'],
                                   'team_id': team_id}"/>
                            <field name="team_id"  readonly="1"/>
                        </group>
                        <group>
                            <field name="channel_id"/>
                            <field name="pre_sales_engineer_ids" widget="many2many_tags"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="product_ids" widget="many2many_tags"/>
                            <!--<p>营销 todo</p>-->
                        </group>
                        <group>
                            <field name="solution_ids" widget="many2many_tags"/>
                            <field name="priority" widget="priority"/>
                            <field name="lost_reason" attrs="{'invisible': [('active', '=', True)]}"/>
                            <field name="date_conversion" invisible="1"/>
                        </group>
                    </group>
                </xpath>
            </field>
        </record>
        <record id="yy_pipeline_view_kanban_inherited" model="ir.ui.view">
            <field name="name">YYCRM pipeline view kanban inherited</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
            <field name="arch" type="xml">
                <field name="color" position="after">
                    <field name="trade"/>
                    <field name="product_ids"/>
                    <field name="planned_revenue"/>
                </field>
                <!--<xpath expr="//[@class='oe_kanban_content']" position="replace">-->
                <!--</xpath>-->
            </field>
        </record>

        <record id="yy_cus_action" model="ir.actions.act_window">
            <!--添加domain让res.partner只出现customer-->
            <field name="name">YYCRM res partner action</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{'default_user_id':uid}</field>
            <field name="domain">[('customer','=',True), ('parent_id', '=', False)]</field>
        </record>
        <record id="yy_cus_cmp_action" model="ir.actions.act_window">
            <!--添加domain让res.partner只出现customer的公司-->
            <field name="name">YYCRM res partner action_cmp</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="yy_cus_view_tree"/>
            <field name="context">{'default_company_type':'company', 'default_user_id':uid}</field>
            <field name="domain">[('customer','=',True), ('parent_id', '=', False),('is_company','=',True)]</field>
        </record>
        <record id="yy_cus_ind_action" model="ir.actions.act_window">
            <!--添加domain让res.partner只出现customer的个人-->
            <field name="name">YYCRM res partner action_ind</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="yy_cus_view_tree"/>
            <field name="context">{'default_company_type':'person', 'default_user_id':uid}</field>
            <field name="domain">[('customer','=',True), ('parent_id', '=', False),('is_company','=',False)]</field>
        </record>
        <menuitem id="base.menu_partner_form" name="Customer" parent="base.menu_sales" action="yy_cus_action"/><!--修改Customer的action-->
        <menuitem id="yycrm_customer_company" name="Company" parent="base.menu_partner_form" action="yy_cus_cmp_action"/>
        <menuitem id="yycrm_customer_individual" name="Individual" parent="base.menu_partner_form" action="yy_cus_ind_action"/>

        测试
        <act_window id='hello_test_1' name="test_1" res_model="crm.lead"  view_type='form' view_mode="yykanban,tree,form,search"
            domain="[('type','=','opportunity')]" context="{'stage_type': 'opportunity','default_type': 'opportunity','default_user_id': uid,'search_default_assigned_to_me': 1,}"/>
        <record id="my_view" model="ir.ui.view">
            <field name="name">Hello Test</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <yykanban default_group_by="stage_id" class="o_kanban_small_column">
                    <field name="stage_id" options="{&quot;group_by_tooltip&quot;: {&quot;requirements&quot;: &quot;Description&quot;, &quot;legend_priority&quot;: &quot;Use of stars&quot;}}"/>
                    <field name="color"/>
                    <field name="priority"/>
                    <field name="planned_revenue"/>
                    <field name="user_email"/>
                    <field name="user_id"/>
                    <field name="partner_address_email"/>
                    <field name="message_needaction_counter"/>
                    <field name="tag_ids"/>
                    <field name="partner_id"/>
                    <field name="active"/>
                    <field name="company_currency"/>
                    <templates>
                        <field name="date_deadline"/>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click">
                                <div class="o_dropdown_kanban dropdown">

                                    <a class="dropdown-toggle btn" data-toggle="dropdown" href="#">
                                        <span class="fa fa-bars fa-lg"/>
                                    </a>
                                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                        <t t-if="widget.editable"><li><a type="edit">Edit</a></li></t>
                                        <t t-if="widget.deletable"><li><a type="delete">Delete</a></li></t>
                                        <li t-if="! record.active.value"><a name="action_set_active" type="object">Unarchive</a></li>
                                        <li t-if="record.active.value"><a name="action_set_unactive" type="object">Archive</a></li>
                                        <li><ul class="oe_kanban_colorpicker" data-field="color"/></li>
                                    </ul>
                                </div>
                                <div class="oe_kanban_content">
                                    <div>
                                        <field name="tag_ids"/>
                                    </div>
                                    <div>
                                        <strong><field name="name"/></strong>
                                    </div>
                                    <div class="text-muted">
                                        <t t-if="record.planned_revenue.raw_value"><field name="planned_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/></t> <span t-if="record.partner_id.value"> - <t t-esc="record.partner_id.value"/></span>
                                    </div>
                                    <div class="text-muted">
                                        <t t-if="record.date_action.raw_value and record.date_action.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
                                        <span t-attf-class="#{red || ''}">
                                            <field name="date_action"/>
                                            <t t-if="record.date_action.raw_value"> : </t>
                                            <field name="next_activity_id"/>
                                        </span>
                                    </div>
                                    <div class="o_kanban_footer">
                                        <field name="priority" widget="priority" groups="base.group_user"/>
                                        <t t-if="record.message_needaction_counter.raw_value">
                                            <span class="oe_kanban_mail_new" title="Unread Messages"><i class="fa fa-comments"/><t t-raw="record.message_needaction_counter.raw_value"/></span>
                                        </t>
                                        <img t-att-src="kanban_image('res.users', 'image_small', record.user_id.raw_value)" t-att-title="record.user_id.value" width="24" height="24" class="oe_kanban_avatar pull-right"/>
                                    </div>
                                </div>
                                <div class="oe_clear"/>
                            </div>
                        </t>
                    </templates>
                </yykanban>
            </field>
        </record>
        <record id="my_view_crm_case_leads_filter" model="ir.ui.view">
            <field name="name">CRM - Leads Search</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <search string="Search Leads">
                    <field name="name" string="Lead / Customer" filter_domain="['|','|','|',('partner_name','ilike',self),('email_from','ilike',self),('contact_name','ilike',self),('name','ilike',self)]"/>
                    <field name="tag_ids" string="Tag" filter_domain="[('tag_ids', 'ilike', self)]"/>
                    <field name="team_id"/>
                    <field name="user_id"/>
                    <field name="partner_id" operator="child_of" string="Customer"/>
                    <field name="create_date"/>
                    <field name="country_id"/>
                    <separator />
                    <filter string="My Leads"
                            name="assigned_to_me"
                            domain="[('user_id','=',uid)]"
                            help="Leads that are assigned to me"/>
                    <filter string="Unassigned" name="unassigned"
                            domain="[('user_id','=', False)]"
                            help="No salesperson"/>
                    <separator />
                    <filter string="Unread Messages" name="message_needaction" domain="[('message_needaction','=',True)]"/>
                    <filter string="Archived" name="archived" domain="[('active', '=', False)]"/>
                    <separator />
                    <filter string="Exclude Opt Out"
                            name='not_opt_out' domain="[('opt_out', '=', False)]"
                            help="Leads that did not ask not to be included in mass mailing campaigns"/>
                    <group expand="0" string="Group By">
                        <filter string="Salesperson" name="groupby_salesperson" domain="[]" context="{'group_by':'user_id'}"/>
                        <filter string="Sales Team" name="groupby_team" domain="[]" context="{'group_by':'team_id'}"/>
                        <filter string="Stage" name="groupby_stage" domain="[]" context="{'group_by':'stage_id'}"/>
                        <filter name="customer" string="Customer" help="Partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Campaign" name="groupby_campaign"  domain="[]" context="{'group_by':'campaign_id'}"/>
                        <filter string="Source" name="groupby_source" domain="[]" context="{'group_by':'source_id'}"/>
                        <filter string="Medium" name="groupby_channel" domain="[]" context="{'group_by':'medium_id'}"/>
                        <filter string="Creation Month" name="groupby_createmonth" domain="[]" context="{'group_by':'create_date'}"/>
                    </group>
                </search>
            </field>
        </record>
        <menuitem id="menu_test_1" name="Test Menu"/>
        <menuitem id="menu_test_2" name="Hello" parent="menu_test_1" action="hello_test_1"/>


    </data>
</openerp>